<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Deploying Facebox to AWS ECS @ Alex Pliutau's Blog</title>
        <meta name="description" content="Currently I am building a product on top of face recognition functionality and I am using Facebox with go-sdk as it&rsquo;s the easiest way to add face recognition features to your project. And it&rsquo;s super developer friendly:
docker run -p 8080:8080 -e &quot;MB_KEY=$MB_KEY&quot; machinebox/facebox  Today it&rsquo;s time for me to deploy the project. And since we use AWS I have to deploy my Facebox instance to ECS (Elastic Container Service).">
        <meta name="keywords" content="machinebox, facebox, aws, docker, alex pliutau, golang, go, programming, docker, swagger, git">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.52" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Deploying Facebox to AWS ECS">
<meta property="og:description" content="Currently I am building a product on top of face recognition functionality and I am using Facebox with go-sdk as it&rsquo;s the easiest way to add face recognition features to your project. And it&rsquo;s super developer friendly:
docker run -p 8080:8080 -e &quot;MB_KEY=$MB_KEY&quot; machinebox/facebox  Today it&rsquo;s time for me to deploy the project. And since we use AWS I have to deploy my Facebox instance to ECS (Elastic Container Service).">
<meta property="og:type" content="article">
<meta property="og:url" content="/deploying-facebox-to-aws-ecs/">

<meta property="og:image" content="/facebox-ecs.png" />


        <link rel="stylesheet" href="/dist/styles.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        
		<link rel="shortcut icon" href="/favicon.ico">
		
			<script id="dsq-count-scr" src="//pliutau.disqus.com/count.js" async></script>
		
    </head>
    <body>
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-72731922-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/pliutau">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Youtube" title="Youtube" href="https://www.youtube.com/packagemain">
                                <i class="fa fa-youtube"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/plutov">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/350294/pltvs">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/pltvs/">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" title="Email" href="mailto:a.pliutau@gmail.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/page/about/">About</a>
    </li>

    <li class="site-nav-item">
        <a title="Hire Me" href="/page/hire-me/">Hire Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Subscribe" href="https://eepurl.com/cDoD09">Subscribe</a>
    </li>

    <li class="site-nav-item">
        <a title="Buy me a coffee" href="https://www.buymeacoffee.com/packagemain">Buy me a coffee</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Deploying Facebox to AWS ECS</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2018-08-09"  itemprop="datePublished">Thu, Aug 9, 2018</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://pliutau.com" itemprop="url" rel="author">Alex Pliutau</a>
            </span>
        </span>
    </p>
</header>
		<footer class="post-footer clearfix share-middle">
    <div class="share">
	<a class="icon-twitter" href="https://twitter.com/share?text=Deploying%20Facebox%20to%20AWS%20ECS&url=%2fdeploying-facebox-to-aws-ecs%2f"
		onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
		<i class="fa fa-twitter"></i>
		<span class="hidden">Twitter</span>
	</a>

	<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fdeploying-facebox-to-aws-ecs%2f"
		onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
		<i class="fa fa-facebook"></i>
		<span class="hidden">Facebook</span>
	</a>

	<a class="icon-google-plus" href="https://plus.google.com/share?url=%2fdeploying-facebox-to-aws-ecs%2f"
	  onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
	  <i class="fa fa-google-plus"></i>
		<span class="hidden">Google+</span>
	</a>

	<a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Deploying%20Facebox%20to%20AWS%20ECS&url=%2fdeploying-facebox-to-aws-ecs%2f&summary="
	   onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
	   <i class="fa fa-linkedin"></i>
	   <span class="hidden">LinkedIn</span>
	</a>
</div>

</footer>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:100%;height:90px;margin-top:20px;margin-bottom:20px;"
     data-ad-client="ca-pub-9796117147060610"
     data-ad-slot="8595828683"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <div class="post-content clearfix" itemprop="articleBody">
    

    

<p><img src="/facebox-ecs.png" alt="Deploying Facebox to AWS ECS" /></p>

<p>Currently I am building a product on top of face recognition functionality and I am using <a href="https://machinebox.io/docs/facebox">Facebox</a> with <a href="https://github.com/machinebox/sdk-go/tree/master/facebox">go-sdk</a> as it&rsquo;s the easiest way to add face recognition features to your project. And it&rsquo;s super developer friendly:</p>

<pre><code>docker run -p 8080:8080 -e &quot;MB_KEY=$MB_KEY&quot; machinebox/facebox
</code></pre>

<p>Today it&rsquo;s time for me to deploy the project. And since we use AWS I have to deploy my Facebox instance to ECS (Elastic Container Service). In this article I&rsquo;ll show you how to do in a few minutes.</p>

<h3 id="create-cluster">Create Cluster</h3>

<p>Go to Services -&gt; ECS and click <a href="https://console.aws.amazon.com/ecs/home?region=us-east-1#/firstRun">Get Started</a> (I am using N. Virginia region but it should work for other regions also).</p>

<p>Select <code>custom</code> image and click <code>Configure</code>.</p>

<p><img src="/facebox-ecs1.png" alt="Deploying Facebox to AWS ECS" /></p>

<h3 id="container-configuration">Container Configuration</h3>

<p>Set the container name and <code>machinebox/facebox</code> image, ECS will pull the one from Docker Hub. Machine Box team is <a href="https://machinebox.io/docs/setup/docker">suggesting</a> to set at least 4GM RAM for your boxes, so we will set the memory limit as 4096. Facebox API is running on container port 8080, so we should expose it. Fargate mode doesn&rsquo;t allow to specify different host port for mapping, so later we&rsquo;re gonna to fix it in EC2 Load Balancing section.</p>

<p><img src="/facebox-ecs2.png" alt="Deploying Facebox to AWS ECS" /></p>

<h3 id="environment-variables">Environment variables</h3>

<p>When you sign up on <a href="https://machinebox.io">machinebox.io</a> you will get a MB_KEY, which you should set as environment variable in <code>Advanced container configuration</code> section.</p>

<p>Also as our Facebox will be accessible by public IP, it&rsquo;s better to protect it with <a href="https://machinebox.io/docs/machine-box-apis#basic-authentication">Basic Auth</a>, so we set <code>MB_BASICAUTH_USER</code> and <code>MB_BASICAUTH_PASS</code> environment variables. All requests to the box must now include the Basic Authentication HTTP header.</p>

<p><img src="/facebox-ecs3.png" alt="Deploying Facebox to AWS ECS" /></p>

<h3 id="task-definition">Task Definition</h3>

<p>Click Task Definition -&gt; Edit and set <code>Task memory: 4GB (4096)</code> and <code>Task CPU: 2 vCPU (2048)</code>, also give a name to our task definition. Click <code>Next</code>.</p>

<h3 id="service-definition">Service Definition</h3>

<p>Here you just need to enable Application Load Balancing with a listener port 8080 and give your service a name.</p>

<p><img src="/facebox-ecs4.png" alt="Deploying Facebox to AWS ECS" /></p>

<h3 id="done">Done</h3>

<p>Set a cluster name, and click <code>Create</code>. It will take few minutes for ECS to pull an image and run it, after some time you will see your cluster is up and task is running:</p>

<p><img src="/facebox-ecs5.png" alt="Deploying Facebox to AWS ECS" /></p>

<h3 id="check-it-out">Check it out</h3>

<p>Now let&rsquo;s change listener port from 8080 to 80, open EC2 -&gt; Load Balancers, go to Listeners tab, find 8080 listener and click <code>Edit</code>. Change 8080 to 80.</p>

<p><img src="/facebox-ecs7.png" alt="Deploying Facebox to AWS ECS" /></p>

<p>As we enabled Application Load Balancing you will be able to access your Facebox Console by a public endpoint. You can find it in your ECS service or in Load Balancer description.</p>

<p>Enter your Basic Auth username / password and you will be able to see the Console.</p>

<p><img src="/facebox-ecs6.png" alt="Deploying Facebox to AWS ECS" /></p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/machinebox/">machinebox</a>
                , 
            
                <a href="/tags/facebox/">facebox</a>
                , 
            
                <a href="/tags/aws/">aws</a>
                , 
            
                <a href="/tags/docker/">docker</a>
                
            
        </p>
    

    <div class="share">
	<a class="icon-twitter" href="https://twitter.com/share?text=Deploying%20Facebox%20to%20AWS%20ECS&url=%2fdeploying-facebox-to-aws-ecs%2f"
		onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
		<i class="fa fa-twitter"></i>
		<span class="hidden">Twitter</span>
	</a>

	<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fdeploying-facebox-to-aws-ecs%2f"
		onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
		<i class="fa fa-facebook"></i>
		<span class="hidden">Facebook</span>
	</a>

	<a class="icon-google-plus" href="https://plus.google.com/share?url=%2fdeploying-facebox-to-aws-ecs%2f"
	  onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
	  <i class="fa fa-google-plus"></i>
		<span class="hidden">Google+</span>
	</a>

	<a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Deploying%20Facebox%20to%20AWS%20ECS&url=%2fdeploying-facebox-to-aws-ecs%2f&summary="
	   onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
	   <i class="fa fa-linkedin"></i>
	   <span class="hidden">LinkedIn</span>
	</a>
</div>

</footer>

		<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{
		width:100%;
		border: 1px solid #dddbcc;
		border-radius: 3px;
		margin: 20px 0;
		background: #f1f0ea;
	}
	#mc_embed_signup .button { background: #f03838 !important; }
</style>
<div id="mc_embed_signup">
<form action="//pliutau.us15.list-manage.com/subscribe/post?u=48e0bc513d92114dd04b36ffa&amp;id=862c25c5fb" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get the latest posts delivered right to your inbox.</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_48e0bc513d92114dd04b36ffa_862c25c5fb" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

        
    <div class="comments">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pliutau" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:100%;height:90px;margin-top:20px;margin-bottom:20px;"
     data-ad-client="ca-pub-9796117147060610"
     data-ad-slot="8595828683"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
</div>

                </div>
        </div>

        <footer class="footer">
            <div class="container">
                <p class="footer-copyright site-title-wrapper">
                    <span>&copy; 2018 Alex Pliutau. All rights reserved.</span>
                </p>
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<script type="text/javascript">
			hljs.initHighlightingOnLoad();
		</script>
    </body>
</html>

