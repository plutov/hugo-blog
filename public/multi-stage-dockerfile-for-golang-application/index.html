<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Multi-stage Dockerfile for Golang application @ Alex Pliutau's Blog</title>
        <meta name="description" content="A common workaround for building Golang application in Docker is to have 2 Dockerfiles - one to perform a build and another to ship the results of the first build without tooling in the first image. It called Builder Pattern.
Starting from Docker v17.0.5 it will be possible to do it via single Dockerfile using multi-stage builds.
Application Let&rsquo;s start with &ldquo;Hello world&rdquo; application:
package main import &quot;fmt&quot; func main() { fmt.">
        <meta name="keywords" content="go, golang, docker, dockerfile, alex pliutau, golang, go, programming, docker, swagger, git">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.52" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Multi-stage Dockerfile for Golang application">
<meta property="og:description" content="A common workaround for building Golang application in Docker is to have 2 Dockerfiles - one to perform a build and another to ship the results of the first build without tooling in the first image. It called Builder Pattern.
Starting from Docker v17.0.5 it will be possible to do it via single Dockerfile using multi-stage builds.
Application Let&rsquo;s start with &ldquo;Hello world&rdquo; application:
package main import &quot;fmt&quot; func main() { fmt.">
<meta property="og:type" content="article">
<meta property="og:url" content="/multi-stage-dockerfile-for-golang-application/">

<meta property="og:image" content="/multi-stage.png" />


        <link rel="stylesheet" href="/dist/styles.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        
		<link rel="shortcut icon" href="/favicon.ico">
		
			<script id="dsq-count-scr" src="//pliutau.disqus.com/count.js" async></script>
		
    </head>
    <body>
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-72731922-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/pliutau">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Youtube" title="Youtube" href="https://www.youtube.com/packagemain">
                                <i class="fa fa-youtube"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/plutov">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/350294/pltvs">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/pltvs/">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" title="Email" href="mailto:a.pliutau@gmail.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/page/about/">About</a>
    </li>

    <li class="site-nav-item">
        <a title="Hire Me" href="/page/hire-me/">Hire Me</a>
    </li>

    <li class="site-nav-item">
        <a title="Subscribe" href="https://eepurl.com/cDoD09">Subscribe</a>
    </li>

    <li class="site-nav-item">
        <a title="Buy me a coffee" href="https://www.buymeacoffee.com/packagemain">Buy me a coffee</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Multi-stage Dockerfile for Golang application</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2017-04-30"  itemprop="datePublished">Sun, Apr 30, 2017</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://pliutau.com" itemprop="url" rel="author">Alex Pliutau</a>
            </span>
        </span>
    </p>
</header>
		<footer class="post-footer clearfix share-middle">
    <div class="share">
	<a class="icon-twitter" href="https://twitter.com/share?text=Multi-stage%20Dockerfile%20for%20Golang%20application&url=%2fmulti-stage-dockerfile-for-golang-application%2f"
		onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
		<i class="fa fa-twitter"></i>
		<span class="hidden">Twitter</span>
	</a>

	<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fmulti-stage-dockerfile-for-golang-application%2f"
		onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
		<i class="fa fa-facebook"></i>
		<span class="hidden">Facebook</span>
	</a>

	<a class="icon-google-plus" href="https://plus.google.com/share?url=%2fmulti-stage-dockerfile-for-golang-application%2f"
	  onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
	  <i class="fa fa-google-plus"></i>
		<span class="hidden">Google+</span>
	</a>

	<a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Multi-stage%20Dockerfile%20for%20Golang%20application&url=%2fmulti-stage-dockerfile-for-golang-application%2f&summary="
	   onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
	   <i class="fa fa-linkedin"></i>
	   <span class="hidden">LinkedIn</span>
	</a>
</div>

</footer>

		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:100%;height:90px;margin-top:20px;margin-bottom:20px;"
     data-ad-client="ca-pub-9796117147060610"
     data-ad-slot="8595828683"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

        <div class="post-content clearfix" itemprop="articleBody">
    

    

<p><img src="/multi-stage.png" alt="multi-stage" /></p>

<p>A common workaround for building Golang application in Docker is to have 2 Dockerfiles - one to perform a build and another to ship the results of the first build without  tooling in the first image. It called <code>Builder Pattern</code>.</p>

<p>Starting from Docker <code>v17.0.5</code> it <em>will</em> be possible to do it via single Dockerfile using multi-stage builds.</p>

<h3 id="application">Application</h3>

<p>Let&rsquo;s start with &ldquo;Hello world&rdquo; application:</p>

<pre><code>package main

import &quot;fmt&quot;

func main() {
	fmt.Println(&quot;Hello world!&quot;)
}
</code></pre>

<h3 id="single-dockerfile">Single Dockerfile</h3>

<p>With multi-stage builds, a Dockerfile allows multiple FROM directives, and the image is created via the last FROM directive of the Dockerfile.</p>

<p><code>COPY â€“from=0</code> takes the file <code>app</code> from the previous stage and copies it to the <code>WORKDIR</code>. This basically copies the compiled go binary created from the previous stage.</p>

<p>The <code>--from</code> flag uses a zero-based index for the stage. You either reference stages by using offsets (like <code>--from=0</code>) or by using names. To name a stage use the syntax FROM [image] as [name].</p>

<pre><code>FROM golang:1.8.1

WORKDIR /go/src/github.com/plutov/golang-multi-stage/

COPY main.go .

RUN GOOS=linux go build -o app .

FROM alpine:latest
RUN apk --no-cache add ca-certificates

WORKDIR /root/

COPY --from=0 /go/src/github.com/plutov/golang-multi-stage/app .

CMD [&quot;./app&quot;]
</code></pre>

<h3 id="build-and-check-size">Build and check size</h3>

<pre><code>docker build .
</code></pre>

<p>Container size now is small, because it contains only binary file.</p>

<pre><code>docker ps
REPOSITORY          TAG     IMAGE ID            CREATED           SIZE

golang-multi-stage  latest  bcbbf69a9b59        6 minutes ago     6.7MB
</code></pre>

<h3 id="conclusion">Conclusion</h3>

<p>Once the feature is released I would switch over. But for now we can use <code>Builder Pattern</code> as a workaround.</p>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="/tags/go/">go</a>
                , 
            
                <a href="/tags/golang/">golang</a>
                , 
            
                <a href="/tags/docker/">docker</a>
                , 
            
                <a href="/tags/dockerfile/">dockerfile</a>
                
            
        </p>
    

    <div class="share">
	<a class="icon-twitter" href="https://twitter.com/share?text=Multi-stage%20Dockerfile%20for%20Golang%20application&url=%2fmulti-stage-dockerfile-for-golang-application%2f"
		onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
		<i class="fa fa-twitter"></i>
		<span class="hidden">Twitter</span>
	</a>

	<a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fmulti-stage-dockerfile-for-golang-application%2f"
		onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
		<i class="fa fa-facebook"></i>
		<span class="hidden">Facebook</span>
	</a>

	<a class="icon-google-plus" href="https://plus.google.com/share?url=%2fmulti-stage-dockerfile-for-golang-application%2f"
	  onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
	  <i class="fa fa-google-plus"></i>
		<span class="hidden">Google+</span>
	</a>

	<a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Multi-stage%20Dockerfile%20for%20Golang%20application&url=%2fmulti-stage-dockerfile-for-golang-application%2f&summary="
	   onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
	   <i class="fa fa-linkedin"></i>
	   <span class="hidden">LinkedIn</span>
	</a>
</div>

</footer>

		<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{
		width:100%;
		border: 1px solid #dddbcc;
		border-radius: 3px;
		margin: 20px 0;
		background: #f1f0ea;
	}
	#mc_embed_signup .button { background: #f03838 !important; }
</style>
<div id="mc_embed_signup">
<form action="//pliutau.us15.list-manage.com/subscribe/post?u=48e0bc513d92114dd04b36ffa&amp;id=862c25c5fb" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get the latest posts delivered right to your inbox.</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_48e0bc513d92114dd04b36ffa_862c25c5fb" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

        
    <div class="comments">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "pliutau" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:inline-block;width:100%;height:90px;margin-top:20px;margin-bottom:20px;"
     data-ad-client="ca-pub-9796117147060610"
     data-ad-slot="8595828683"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </article>
</div>

                </div>
        </div>

        <footer class="footer">
            <div class="container">
                <p class="footer-copyright site-title-wrapper">
                    <span>&copy; 2018 Alex Pliutau. All rights reserved.</span>
                </p>
            </div>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<script type="text/javascript">
			hljs.initHighlightingOnLoad();
		</script>
    </body>
</html>

